<!DOCTYPE html>
<html lang="en">
<head>  
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="theme-color" content="#2e7d32">
<title>{{ highlights.reference_id }} - {{ car_details.make }} {{ car_details.model }} Inspection Report</title>
<style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: #f5f8fb;
        color: #333;
        margin: 0;
        padding: 20px;
        font-size: 1.05em; /* slightly larger for phone readability */
    }

    h1, h2, h3 {
        color: #1b4f72;
        margin-bottom: 5px;
    }

    /* --- Overall Condition Section --- */
    .overall-condition {
        margin: 20px auto;
        padding: 15px;
        max-width: 500px;
        border-radius: 10px;
        background: #f9fdf9;
        text-align: center;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
    }

    .overall-condition:hover {
        transform: scale(1.02);
    }

    .overall-condition h3 {
        color: #2e7d32;
        font-weight: 600;
        margin-bottom: 10px;
    }

    .condition-bar {
        width: 80%;
        height: 14px;
        background: #e0e0e0;
        border-radius: 10px;
        margin: 0 auto 8px;
        overflow: hidden;
    }

    .condition-fill {
        height: 100%;
        background: linear-gradient(90deg, #4caf50, #81c784);
        border-radius: 10px;
        width: 0%;
        transition: width 1s ease-in-out;
    }

    .condition-text {
        font-size: 1.1em;
        color: #333;
    }

    /* --- Header --- */
    .report-header {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        justify-content: center;
        background-color: #eaf3f8;
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 20px;
        box-shadow: 0px 2px 8px rgba(0,0,0,0.1);
        text-align: center;
    }

    .logo {
        flex: 0 0 auto;
        margin-right: 15px;
    }

    .logo img {
        height: 70px;
        border-radius: 10px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        transition: transform 0.3s ease;
    }

    .logo img:hover {
        transform: scale(1.05);
    }

    .report-header-text {
        flex: 1;
        min-width: 250px;
    }

    .accordion {
        background-color: #ffffff;
        border-radius: 8px;
        margin-bottom: 15px;
        border-left: 4px solid #1abc9c;
        box-shadow: 0px 2px 6px rgba(0,0,0,0.05);
        transition: all 0.3s ease;
    }

    .accordion-header {
        padding: 15px 20px;
        cursor: pointer;
        font-weight: bold;
        font-size: 1.1em;
        user-select: none;
        transition: background 0.3s ease, color 0.4s ease;
        position: relative;
        padding-right: 35px;
    }

    .accordion-header:hover {
        background-color: #e1f4f1;
    }

    .accordion-header::after {
        content: "â–¶";
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%) rotate(0deg);
        font-size: 1em;
        color: #1abc9c;
        transition: transform 0.3s ease;
    }

    .accordion.active .accordion-header::after {
        transform: translateY(-50%) rotate(90deg);
    }

    .accordion-content {
        max-height: 0;
        overflow: hidden;
        padding: 0 20px;
        border-top: 1px solid #ddd;
        transition: max-height 0.35s ease, padding 0.35s ease;
    }

    .accordion.active .accordion-content {
        max-height: 2000px;
        padding: 15px 20px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 10px;
        table-layout: fixed;
        word-wrap: break-word;
    }

    th, td {
        text-align: left;
        padding: 10px;
        border-bottom: 1px solid #ddd;
        font-size: 1.05em;
    }

    th {
        background-color: #f0f9f8;
        color: #0e6251;
    }

    .field-label {
        font-weight: bold;
        color: #1abc9c;
    }

    .comments {
        background: #f0f9f8;
        padding: 10px;
        border-radius: 6px;
        margin-top: 5px;
        word-wrap: break-word;
    }

    /* Responsive Styles */
    @media screen and (max-width: 768px) {
        body { padding: 10px; font-size: 1.05em; }
        .report-header { padding: 15px; flex-direction: column; text-align: center; }
        .logo { margin-bottom: 10px; margin-right: 0; }
        .logo img { height: 60px; }
        .accordion-header { font-size: 1.05em; padding: 12px 15px; }
        table, th, td { font-size: 1em; }
        .car-images img { max-width: 45%; }
    }

    @media screen and (max-width: 480px) {
        .accordion-header { font-size: 1em; }
        table, th, td { font-size: 0.95em; }
        .car-images img { max-width: 100%; }
    }
</style>
</head>

<body>

<!-- Header with Company Logo -->
<div class="report-header" style="
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    background-color: #eaf3f8;
    padding: 20px;
    border-radius: 12px;
    margin-bottom: 20px;
    box-shadow: 0px 2px 8px rgba(0,0,0,0.1);
">
    <div class="logo-section" style="flex: 1; min-width: 150px; text-align: left;">
        <img src="https://raw.githubusercontent.com/Ghost-0-0-hub/inspection-assets/main/CompanyLogo.jpg?raw=true"
             alt="Company Logo"
     style="max-height:70px; border-radius:8px; object-fit:contain;">
    </div>

    <div class="title-section" style="flex: 2; min-width: 250px; text-align: right;">
        <h1 style="margin: 0; color: #1b4f72;">Vehicle Inspection Report</h1>
        <p style="margin: 5px 0 0 0;">
            <strong>Date:</strong> {{ date }} &nbsp; | &nbsp;
            <strong>Reference ID:</strong> {{ highlights.reference_id }} &nbsp; | &nbsp;
            <strong>Car:</strong> {{ car_details.make }} {{ car_details.model }} {{ car_details.variant }} ({{ car_details.model_year }})
        </p>
    </div>
</div>
<!-- Overall Vehicle Condition -->
<div class="overall-condition">
    <h3>Overall Vehicle Condition</h3>
    <div class="condition-bar">
        <div class="condition-fill" style="width: {{ overall_condition }}%;"></div>
    </div>
    <p class="condition-text"><strong>{{ overall_condition }}%</strong> Overall Condition</p>
</div>

<!-- Car Images -->
{% if highlights.hilight_image_b64 %}
<div class="car-images" style="display:flex; flex-wrap:wrap; gap:10px; justify-content:center; margin-bottom:20px;">
    {% for img_b64 in highlights.hilight_image_b64 %}
        <img src="{{ img_b64 }}" alt="Car Image" style="max-width:250px; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.15);">
    {% endfor %}
</div>
{% endif %}

<!-- Accordion Template -->
{% macro accordion(title, content, percent) %}
<div class="accordion">
    <div class="accordion-header">
        {{ title }} -
        <span style="
            color: {% if percent >= 80 %}#2e7d32{% elif percent >= 50 %}#f9a825{% else %}#c62828{% endif %};
            font-weight: bold;">
            {{ percent }}%
        </span>
    </div>
    <div class="accordion-content">
        {{ content }}
    </div>
</div>
{% endmacro %}

<!-- Highlights -->
{% set highlights_content %}
<table>
<tr><th>Field</th><th>Value</th></tr>
<tr><td class="field-label">Mileage</td><td>{{ highlights.mileage }} km</td></tr>
<tr><td class="field-label">Color</td><td>{{ highlights.color }}</td></tr>
<tr><td class="field-label">Fuel Type</td><td>{{ highlights.fuel_type }}</td></tr>
<tr><td class="field-label">Transmission</td><td>{{ highlights.transmission }}</td></tr>
<tr><td class="field-label">Drive Type</td><td>{{ highlights.drive_type }}</td></tr>
<tr><td class="field-label">Pick-up Location</td><td>{{ highlights.pickup_location }}</td></tr>
<tr><td class="field-label">Registration City</td><td>{{ highlights.registration_city }}</td></tr>
<tr><td class="field-label">Registration Type</td><td>{{ highlights.registration_type }}</td></tr>
</table>
{% endset %}
{{ accordion('Highlights', highlights_content, completion.highlights) }}

<!-- Car Details -->
{% set car_details_content %}
<table>
<tr><th>Field</th><th>Value</th></tr>
{% for key, value in car_details.items() %}
<tr><td class="field-label">{{ key.replace('_',' ').title() }}</td><td>{{ value }}</td></tr>
{% endfor %}
</table>
{% endset %}
{{ accordion('Car Details', car_details_content, completion.car_details) }}

<!-- Documents -->
{% set documents_content %}
<table>
<tr><th>Document</th><th>Status</th></tr>
{% for key, value in documents.items() %}
<tr><td class="field-label">{{ key.replace('_',' ').title() }}</td><td>{{ value }}</td></tr>
{% endfor %}
</table>
{% endset %}
{{ accordion('Documents', documents_content, completion.documents) }}

<!-- Interior -->
{% set interior_content %}
<table>
<tr><th>Item</th><th>Condition</th></tr>
{% for key, value in interior.items() if key != 'interior_comments' %}
<tr><td class="field-label">{{ key.replace('_',' ').title() }}</td><td>{{ value }}</td></tr>
{% endfor %}
</table>
{% if interior.interior_comments %}
<div class="comments"><strong>Comments:</strong> {{ interior.interior_comments }}</div>
{% endif %}
{% endset %}
{{ accordion('Interior', interior_content, completion.interior) }}

<!-- Car Body Evaluation -->
{% set car_body_content %}
<table>
<tr><th>Panel</th><th>Condition</th></tr>
{% for panel, condition in car_body_panels.items() %}
<tr><td class="field-label">{{ panel }}</td><td>{{ condition }}</td></tr>
{% endfor %}
</table>
<div class="comments">
<strong>Overall Exterior:</strong> {{ car_body.overall_exterior_condition }}<br>
<strong>Overall Interior:</strong> {{ car_body.overall_interior_condition }}<br>
<strong>Comments:</strong> {{ car_body.comments }}
</div>
{% endset %}
{{ accordion('Car Body Evaluation', car_body_content, completion.car_body) }}

<!-- Mechanical -->
{% set mechanical_content %}
<table>
<tr><th>Component</th><th>Status</th></tr>
{% for key, value in mechanical.items() if key != 'mechanical_comments' %}
<tr><td class="field-label">{{ key.replace('_',' ').title() }}</td><td>{{ value }}</td></tr>
{% endfor %}
</table>
{% if mechanical.mechanical_comments %}
<div class="comments"><strong>Comments:</strong> {{ mechanical.mechanical_comments }}</div>
{% endif %}
{% endset %}
{{ accordion('Mechanical', mechanical_content, completion.mechanical) }}

<!-- Suspension -->
{% set suspension_content %}
<table>
<tr><th>Part</th><th>Status</th></tr>
{% for group, items in suspension_parts.items() %}
<tr><td colspan="2" class="field-label">{{ group.replace('_',' ').title() }}</td></tr>
{% for key, value in items.items() %}
<tr><td style="padding-left:20px">{{ key }}</td><td>{{ value }}</td></tr>
{% endfor %}
{% endfor %}
</table>
{% if suspension.suspension_comments %}
<div class="comments"><strong>Comments:</strong> {{ suspension.suspension_comments }}</div>
{% endif %}
{% endset %}
{{ accordion('Suspension', suspension_content, completion.suspension) }}

<!-- Electrical -->
{% set electrical_content %}
<table>
<tr><th>Component</th><th>Status</th></tr>
{% for key, value in electrical.items() if key != 'electrical_comments' %}
<tr><td class="field-label">{{ key.replace('_',' ').title() }}</td><td>{{ value }}</td></tr>
{% endfor %}
</table>
{% if electrical.electrical_comments %}
<div class="comments"><strong>Comments:</strong> {{ electrical.electrical_comments }}</div>
{% endif %}
{% endset %}
{{ accordion('Electrical', electrical_content, completion.electrical) }}

<!-- Tires -->
{% set tires_content %}
<table>
<tr><th>Tire</th><th>Condition</th></tr>
{% for key, value in tires.items() if key != 'comments' %}
<tr><td class="field-label">{{ key.replace('_',' ').title() }}</td><td>{{ value }}</td></tr>
{% endfor %}
</table>
{% if tires.comments %}
<div class="comments"><strong>Comments:</strong> {{ tires.comments }}</div>
{% endif %}
{% endset %}
{{ accordion('Tires', tires_content, completion.tires) }}

<!-- Accessories -->
{% set accessories_content %}
<table>
<tr><th>Accessory</th><th>Status</th></tr>
{% for key, value in accessories.items() %}
<tr><td class="field-label">{{ key.replace('_',' ').title() }}</td><td>{{ value }}</td></tr>
{% endfor %}
</table>
{% endset %}
{{ accordion('Accessories', accessories_content, completion.accessories) }}

<!-- Test Drive -->
{% set test_drive_content %}
<table>
<tr><th>Test Item</th><th>Status</th></tr>
{% for key, value in test_drive.items() if key != 'comments' %}
<tr><td class="field-label">{{ key.replace('_',' ').title() }}</td><td>{{ value }}</td></tr>
{% endfor %}
</table>
{% if test_drive.comments %}
<div class="comments"><strong>Comments:</strong> {{ test_drive.comments }}</div>
{% endif %}
{% endset %}
{{ accordion('Test Drive', test_drive_content, completion.test_drive) }}

<!-- Final Comments -->
{% set final_content %}
<div class="comments">
<p><strong>Inspector:</strong> {{ final.inspector_name }}</p>
<p><strong>Overall Condition:</strong> {{ final.overall_condition }}</p>
<p><strong>Final Comments:</strong> {{ final.final_comments }}</p>
</div>
{% endset %}
{{ accordion('Final Comments', final_content, completion.final) }}

<script>
document.addEventListener("DOMContentLoaded", function() {
    // Accordion toggle fix for iPhone and desktop
    document.querySelectorAll(".accordion-header").forEach(header => {
        const toggleAccordion = () => {
            header.parentElement.classList.toggle("active");
        };
        header.addEventListener("click", toggleAccordion);       // for desktop
        header.addEventListener("touchstart", toggleAccordion);  // for iPhone / iPad
    });

    // Animate condition bar after load
    const fill = document.querySelector(".condition-fill");
    if (fill) {
        fill.style.width = "0%";
        setTimeout(() => {
            fill.style.width = "{{ overall_condition }}%";
        }, 300);
    }
});
</script>

</body>
</html>
