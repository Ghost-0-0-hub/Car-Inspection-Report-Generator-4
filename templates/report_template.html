<!DOCTYPE html>
<html lang="en">
<head>  
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="theme-color" content="#2e7d32">
<title>{{ highlights.reference_id }} - {{ car_details.make }} {{ car_details.model }} Inspection Report</title>
<style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: #f5f8fb;
        color: #333;
        margin: 0;
        padding: 20px;
        font-size: 1.05em; /* slightly larger for phone readability */
    }

    h1, h2, h3 {
        color: #1b4f72;
        margin-bottom: 5px;
    }

    /* --- Overall Condition Section --- */
    .overall-condition {
        margin: 20px auto;
        padding: 15px;
        max-width: 500px;
        border-radius: 10px;
        background: #f9fdf9;
        text-align: center;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .overall-condition h3 {
        color: #2e7d32;
        font-weight: 600;
        margin-bottom: 10px;
    }

    .condition-bar {
        width: 80%;
        height: 14px;
        background: #e0e0e0;
        border-radius: 10px;
        margin: 0 auto 8px;
        overflow: hidden;
    }

    .condition-fill {
        height: 100%;
        background: linear-gradient(90deg, #4caf50, #81c784);
        border-radius: 10px;
        width: {{ overall_condition }}%;
        transition: width 1s ease-in-out;
    }

    .condition-text {
        font-size: 1.1em;
        color: #333;
    }

    /* --- Header --- */
    .report-header {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        justify-content: center;
        background-color: #eaf3f8;
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 20px;
        box-shadow: 0px 2px 8px rgba(0,0,0,0.1);
        text-align: center;
    }

    .logo {
        flex: 0 0 auto;
        margin-right: 15px;
    }

    .logo img {
        height: 70px;
        border-radius: 10px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        transition: transform 0.3s ease;
    }

    .logo img:hover {
        transform: scale(1.05);
    }

    .report-header-text {
        flex: 1;
        min-width: 250px;
    }

    /* --- Accordion --- */
    .accordion {
        background-color: #ffffff;
        border-radius: 8px;
        margin-bottom: 15px;
        border-left: 4px solid #1abc9c;
        box-shadow: 0px 2px 6px rgba(0,0,0,0.05);
    }

    .accordion-header {
        padding: 15px 20px;
        cursor: default;
        font-weight: bold;
        font-size: 1.1em;
        user-select: none;
        color: #0e6251;
        background: #f8fcfc;
        border-bottom: 1px solid #ddd;
        position: relative;
        padding-right: 35px;
    }

    .accordion-header::after {
        content: "â–¼";
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 1em;
        color: #1abc9c;
    }

    .accordion-content {
        max-height: none; /* Always open */
        overflow: visible;
        padding: 15px 20px;
        border-top: 1px solid #ddd;
        background: #fff;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 10px;
        table-layout: fixed;
        word-wrap: break-word;
    }

    th, td {
        text-align: left;
        padding: 10px;
        border-bottom: 1px solid #ddd;
        font-size: 1.05em;
    }

    th {
        background-color: #f0f9f8;
        color: #0e6251;
    }

    .field-label {
        font-weight: bold;
        color: #1abc9c;
    }

    .comments {
        background: #f0f9f8;
        padding: 10px;
        border-radius: 6px;
        margin-top: 5px;
        word-wrap: break-word;
    }

    /* --- Car Images --- */
    .car-images img {
        max-width: 250px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        transition: transform 0.3s ease;
    }

    .car-images img:hover {
        transform: scale(1.03);
    }

    /* --- Responsive Styles --- */
    @media screen and (max-width: 768px) {
        body { padding: 10px; font-size: 1.05em; }
        .report-header { padding: 15px; flex-direction: column; text-align: center; }
        .logo { margin-bottom: 10px; margin-right: 0; }
        .logo img { height: 60px; }
        .accordion-header { font-size: 1.05em; padding: 12px 15px; }
        table, th, td { font-size: 1em; }
        .car-images img { max-width: 45%; }
    }

    @media screen and (max-width: 480px) {
        .accordion-header { font-size: 1em; }
        table, th, td { font-size: 0.95em; }
        .car-images img { max-width: 100%; }
    }
</style>

</head>

<body>

<!-- Header with Company Logo -->
<div class="report-header" style="
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    background-color: #eaf3f8;
    padding: 20px;
    border-radius: 12px;
    margin-bottom: 20px;
    box-shadow: 0px 2px 8px rgba(0,0,0,0.1);
">
    <div class="logo-section" style="flex: 1; min-width: 150px; text-align: left;">
        <img src="data:image/jpeg;base64,{{ logo_base64 }}" alt="Company Logo" style="
            max-height: 70px;
            border-radius: 8px;
            object-fit: contain;
        ">
    </div>

    <div class="title-section" style="flex: 2; min-width: 250px; text-align: right;">
        <h1 style="margin: 0; color: #1b4f72;">Vehicle Inspection Report</h1>
        <p style="margin: 5px 0 0 0;">
            <strong>Date:</strong> {{ date }} &nbsp; | &nbsp;
            <strong>Reference ID:</strong> {{ highlights.reference_id }} &nbsp; | &nbsp;
            <strong>Car:</strong> {{ car_details.make }} {{ car_details.model }} {{ car_details.variant }} ({{ car_details.model_year }})
        </p>
    </div>
</div>
<!-- Overall Vehicle Condition -->
<div class="overall-condition">
    <h3>Overall Vehicle Condition</h3>
    <div class="condition-bar">
        <div class="condition-fill" style="width: {{ overall_condition }}%;"></div>
    </div>
    <p class="condition-text"><strong>{{ overall_condition }}%</strong> Overall Condition</p>
</div>

<!-- Car Images -->
{% if highlights.hilight_image_b64 %}
<div class="car-images" style="display:flex; flex-wrap:wrap; gap:10px; justify-content:center; margin-bottom:20px;">
    {% for img_b64 in highlights.hilight_image_b64 %}
        <img src="{{ img_b64 }}" alt="Car Image" style="max-width:250px; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.15);">
    {% endfor %}
</div>
{% endif %}

<!-- Accordion Template -->
{% macro accordion(title, content, percent) %}
<div class="accordion">
    <div class="accordion-header">
        {{ title }} -
        <span style="
            color: {% if percent >= 80 %}#2e7d32{% elif percent >= 50 %}#f9a825{% else %}#c62828{% endif %};
            font-weight: bold;">
            {{ percent }}%
        </span>
    </div>
    <div class="accordion-content">
        {{ content }}
    </div>
</div>
{% endmacro %}

<!-- Highlights -->
{% set highlights_content %}
<table>
<tr><th>Field</th><th>Value</th></tr>
<tr><td class="field-label">Mileage</td><td>{{ highlights.mileage }} km</td></tr>
<tr><td class="field-label">Color</td><td>{{ highlights.color }}</td></tr>
<tr><td class="field-label">Fuel Type</td><td>{{ highlights.fuel_type }}</td></tr>
<tr><td class="field-label">Transmission</td><td>{{ highlights.transmission }}</td></tr>
<tr><td class="field-label">Drive Type</td><td>{{ highlights.drive_type }}</td></tr>
<tr><td class="field-label">Pick-up Location</td><td>{{ highlights.pickup_location }}</td></tr>
<tr><td class="field-label">Registration City</td><td>{{ highlights.registration_city }}</td></tr>
<tr><td class="field-label">Registration Type</td><td>{{ highlights.registration_type }}</td></tr>
</table>
{% endset %}
{{ accordion('Highlights', highlights_content, completion.highlights) }}

<!-- Car Details -->
{% set car_details_content %}
<table>
<tr><th>Field</th><th>Value</th></tr>
{% for key, value in car_details.items() %}
<tr><td class="field-label">{{ key.replace('_',' ').title() }}</td><td>{{ value }}</td></tr>
{% endfor %}
</table>
{% endset %}
{{ accordion('Car Details', car_details_content, completion.car_details) }}

<!-- Documents -->
{% set documents_content %}
<table>
<tr><th>Document</th><th>Status</th></tr>
{% for key, value in documents.items() %}
<tr>
    <td class="field-label">{{ key.replace('_',' ').title() }}</td>
    <td>
        {% if value == "Not Confirmed" %}
            <i>Not Confirmed</i>
        {% else %}
            {{ value }}
        {% endif %}
    </td>
</tr>
{% endfor %}
</table>
{% endset %}
{{ accordion('Documents', documents_content, completion.documents) }}

<!-- Interior -->
{% set interior_content %}
<table>
<tr><th>Item</th><th>Condition / Status</th></tr>

<!-- Air Conditioning -->
<tr><td class="field-label">Air Conditioning</td><td>{{ interior.ac }}</td></tr>
<tr><td class="field-label">Vents Condition</td><td>{{ interior.vents_condition }}</td></tr>

<!-- Steering Wheel / Driver Airbag -->
<tr><td class="field-label">Steering Wheel</td><td>{{ interior.steering_wheel }}</td></tr>
<tr><td class="field-label">Driver Side Impact Airbag Present</td><td>{{ interior.driver_airbag_present }}</td></tr>
<tr><td class="field-label">Driver Side Impact Airbag Condition</td><td>{{ interior.driver_airbag_condition }}</td></tr>

<!-- Carpet -->
<tr><td class="field-label">Driver Side Carpet</td><td>{{ interior.driver_carpet }}</td></tr>
<tr><td class="field-label">Driver Seat Carpet Condition</td><td>{{ interior.driver_seat_carpet_condition }}</td></tr>
<tr><td class="field-label">Passenger Side Carpet</td><td>{{ interior.passenger_carpet }}</td></tr>
<tr><td class="field-label">Passenger Seat Carpet Condition</td><td>{{ interior.passenger_seat_carpet_condition }}</td></tr>

<!-- Seats -->
<tr><td class="field-label">Driver Seat Condition</td><td>{{ interior.driver_seat_condition }}</td></tr>
<tr><td class="field-label">Driver Seat Control Function</td><td>{{ interior.driver_seat_control }}</td></tr>
<tr><td class="field-label">Passenger Seat Condition</td><td>{{ interior.passenger_seat_condition }}</td></tr>

<!-- Passenger Airbag -->
<tr><td class="field-label">Passenger Side Impact Airbag Present</td><td>{{ interior.passenger_airbag_present }}</td></tr>
<tr><td class="field-label">Passenger Side Impact Airbag Condition</td><td>{{ interior.passenger_airbag_condition }}</td></tr>

</table>

{% if interior.interior_comments %}
<div class="comments"><strong>Comments:</strong> {{ interior.interior_comments }}</div>
{% endif %}
{% endset %}
{{ accordion('Interior', interior_content, completion.interior) }}


<!-- Car Body Evaluation -->
{% set car_body_content %}
<table>
<tr><th>Panel</th><th>Condition</th><th>Comment</th></tr>
{% for panel, panel_data in car_body_panels.items() %}
<tr>
  <td class="field-label">{{ panel }}</td>
  <td>{{ panel_data.condition }}</td>
  <td>
    {% if panel_data.comment %}
      <div class="comments">{{ panel_data.comment }}</div>
    {% else %}
      -
    {% endif %}
  </td>
</tr>
{% endfor %}
</table>
{% if body_images %}
<h3 style="margin-top: 20px;">Car Body Evaluation Photos</h3>
<div style="display: flex; flex-wrap: wrap; gap: 10px;">
  {% for img in body_images %}
    <div style="border: 1px solid #ddd; padding: 5px; border-radius: 8px;">
      <img src="{{ img }}" alt="Car Body Image" style="width: 200px; height: auto; border-radius: 6px;">
    </div>
  {% endfor %}
</div>
{% endif %}
<div class="comments">
<strong>Overall Exterior:</strong> {{ car_body.overall_exterior_condition }}<br>
<strong>Overall Interior:</strong> {{ car_body.overall_interior_condition }}<br>
<strong>General Comments:</strong> {{ car_body.comments }}
</div>
{% endset %}
{{ accordion('Car Body Evaluation', car_body_content, completion.car_body) }}

<!-- Exterior -->
{% set exterior_content %}
<table>
  <tr><th>Field</th><th>Condition / Status</th></tr>
  <tr><td class="field-label">Frame Type</td><td>{{ exterior.frame_type }}</td></tr>
  <tr><td class="field-label">Front Right Rail Condition</td><td>{{ exterior.front_right_rail }}</td></tr>
  <tr><td class="field-label">Front Left Rail Condition</td><td>{{ exterior.front_left_rail }}</td></tr>
  <tr><td class="field-label">Left Rail Condition</td><td>{{ exterior.left_rail }}</td></tr>
  <tr><td class="field-label">Motor Cradle Condition</td><td>{{ exterior.motor_cradle }}</td></tr>
  <tr><td class="field-label">Lower Core Support Condition</td><td>{{ exterior.lower_core_support }}</td></tr>
  <tr><td class="field-label">Upper Core Support Condition</td><td>{{ exterior.upper_core_support }}</td></tr>
  <tr><td class="field-label">Right Strut Tower Condition</td><td>{{ exterior.right_strut_tower }}</td></tr>
  <tr><td class="field-label">Left Strut Tower Condition</td><td>{{ exterior.left_strut_tower }}</td></tr>
  <tr><td class="field-label">Firewall Condition</td><td>{{ exterior.firewall_condition }}</td></tr>
  <tr><td class="field-label">Floor Plan Condition</td><td>{{ exterior.floor_plan_condition }}</td></tr>
  <tr><td class="field-label">Bonnet Seal Condition</td><td>{{ exterior.bonnet_seal }}</td></tr>
  <tr><td class="field-label">Trunk Seal Condition</td><td>{{ exterior.trunk_seal }}</td></tr>
  <tr><td class="field-label">Trunk Carpet Condition</td><td>{{ exterior.trunk_carpet }}</td></tr>
  <tr><td class="field-label">Front Left Door Handle Condition</td><td>{{ exterior.front_left_door_handle }}</td></tr>
  <tr><td class="field-label">Front Right Door Handle Condition</td><td>{{ exterior.front_right_door_handle }}</td></tr>
  <tr><td class="field-label">Back Left Door Hinges Condition</td><td>{{ exterior.back_left_door_hinges }}</td></tr>
  <tr><td class="field-label">Back Right Door Hinges Condition</td><td>{{ exterior.back_right_door_hinges }}</td></tr>
  <tr><td class="field-label">Has Sunroof</td><td>{{ exterior.has_sunroof }}</td></tr>
  {% if exterior.has_sunroof == "Yes" %}
  <tr><td class="field-label">Sunroof Condition</td><td>{{ exterior.sunroof_condition }}</td></tr>
  {% endif %}
  <tr><td class="field-label">Front Right Fender Shield Condition</td><td>{{ exterior.front_right_fender_shield }}</td></tr>
  <tr><td class="field-label">Front Left Fender Shield Condition</td><td>{{ exterior.front_left_fender_shield }}</td></tr>
  <tr><td class="field-label">Back Right Fender Shield Condition</td><td>{{ exterior.back_right_fender_shield }}</td></tr>
  <tr><td class="field-label">Back Left Fender Shield Condition</td><td>{{ exterior.back_left_fender_shield }}</td></tr>
  <tr><td class="field-label">Back Under Body Condition</td><td>{{ exterior.back_under_body }}</td></tr>
  <tr><td class="field-label">Rear Support Condition</td><td>{{ exterior.rear_support }}</td></tr>
  <tr><td class="field-label">Has Fuel Cap</td><td>{{ exterior.has_fuel_cap }}</td></tr>
  <tr><td class="field-label">Left Side Mirror Condition</td><td>{{ exterior.left_side_mirror }}</td></tr>
</table>

{% if exterior.exterior_comments %}
<div class="comments"><strong>Comments:</strong> {{ exterior.exterior_comments }}</div>
{% endif %}

{% endset %}

{{ accordion('Exterior', exterior_content, completion.exterior) }}

<!-- Mechanical -->
{% set mechanical_content %}
<table>
<tr><th>Component</th><th>Status</th></tr>
{% for key, value in mechanical.items() if key != 'mechanical_comments' %}
<tr><td class="field-label">{{ key.replace('_',' ').title() }}</td><td>{{ value }}</td></tr>
{% endfor %}
</table>
{% if mechanical.mechanical_comments %}
<div class="comments"><strong>Comments:</strong> {{ mechanical.mechanical_comments }}</div>
{% endif %}
{% endset %}
{{ accordion('Mechanical', mechanical_content, completion.mechanical) }}

<!-- Suspension -->
{% set suspension_content %}
<table>
<tr><th>Part</th><th>Status</th></tr>
{% for group, items in suspension_parts.items() %}
<tr><td colspan="2" class="field-label">{{ group.replace('_',' ').title() }}</td></tr>
{% for key, value in items.items() %}
<tr><td style="padding-left:20px">{{ key }}</td><td>{{ value }}</td></tr>
{% endfor %}
{% endfor %}
</table>
{% if suspension.suspension_comments %}
<div class="comments"><strong>Comments:</strong> {{ suspension.suspension_comments }}</div>
{% endif %}
{% endset %}
{{ accordion('Suspension', suspension_content, completion.suspension) }}

<!-- Electrical -->
{% set electrical_content %}
<table>
<tr><th>Component</th><th>Status</th></tr>
{% for key, value in electrical.items() if key != 'electrical_comments' %}
<tr><td class="field-label">{{ key.replace('_',' ').title() }}</td><td>{{ value }}</td></tr>
{% endfor %}
</table>
{% if electrical.electrical_comments %}
<div class="comments"><strong>Comments:</strong> {{ electrical.electrical_comments }}</div>
{% endif %}
{% endset %}
{{ accordion('Electrical', electrical_content, completion.electrical) }}

<!-- Tires -->
{% set tires_content %}
<table>
<tr><th>Tire</th><th>Condition</th></tr>
{% for key, value in tires.items() if key != 'comments' %}
<tr><td class="field-label">{{ key.replace('_',' ').title() }}</td><td>{{ value }}</td></tr>
{% endfor %}
</table>
{% if tires.comments %}
<div class="comments"><strong>Comments:</strong> {{ tires.comments }}</div>
{% endif %}
{% endset %}
{{ accordion('Tires', tires_content, completion.tires) }}

<!-- Accessories -->
{% set accessories_content %}
<table>
<tr><th>Accessory</th><th>Status</th></tr>
{% for key, value in accessories.items() %}
<tr><td class="field-label">{{ key.replace('_',' ').title() }}</td><td>{{ value }}</td></tr>
{% endfor %}
</table>
{% endset %}
{{ accordion('Accessories', accessories_content, completion.accessories) }}

<!-- Test Drive -->
{% set test_drive_content %}
<table>
<tr><th>Test Item</th><th>Status</th></tr>
{% for key, value in test_drive.items() if key != 'comments' %}
<tr><td class="field-label">{{ key.replace('_',' ').title() }}</td><td>{{ value }}</td></tr>
{% endfor %}
</table>
{% if test_drive.comments %}
<div class="comments"><strong>Comments:</strong> {{ test_drive.comments }}</div>
{% endif %}
{% endset %}
{{ accordion('Test Drive', test_drive_content, completion.test_drive) }}

<!-- Final Comments -->
{% set final_content %}
<div class="comments">
<p><strong>Inspector:</strong> {{ final.inspector_name }}</p>
<p><strong>Overall Condition:</strong> {{ final.overall_condition }}</p>
<p><strong>Final Comments:</strong> {{ final.final_comments }}</p>
</div>
{% endset %}
{{ accordion('Final Comments', final_content, completion.final) }}
<!-- Car Damage Diagram -->
{% if car_damage_diagram_b64 %}
<div style="margin-top:30px; text-align:center;">
    <h2 style="color:#1b4f72;">Car Damage Diagram</h2>
    <img src="{{ car_damage_diagram_b64 }}" alt="Car Damage Diagram" style="max-width:95%; border:1px solid #ccc; border-radius:8px;">
</div>
{% endif %}
</body>
</html>
